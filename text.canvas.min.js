"use strict";window._textCanvas="undefined"!=typeof _textCanvas?_textCanvas:{},window._textCanvas={init:function(e,t,n){var o,i,l=this,a=[],s=document.getElementById(e)||document.getElementsByClassName(e)[0]||document.getElementsByName(e)[0],r={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,xAjust:8.5,yAjust:41.5,left:0,background:"none",color:"black","font-size":"24px","font-family":"serif",padding:"2px",height:"24px",width:"20px",overflow:"hidden",outline:"none","box-shadow":"none","-moz-box-shadow":"none","-webkit-box-shadow":"none",resize:"none"},c=$.extend(r,t);function d(e,t,n){var o=s.getContext("2d");o.font=r["font-size"]+" "+r["font-family"],o.fillStyle=r.color;var i=s.getBoundingClientRect();o.fillText(e.value,t.clientX-i.left+c.xAjust,t.clientY-i.top+c.yAjust),o.restore(),"function"==typeof n&&n(e)}s.onclick=function(e){l.newTextArea(e)};var f=function(e,t,n){var o=document.getElementById("helperSpan");null==o&&((o=document.createElement("span")).id="helperSpan");var i=(i=t.value+"...").replace(/\n/g,"<br />");13==e.keyCode&&(i+="<br />..."),o.innerHTML=i,o.style.display="none",o.style["font-color"]="black",o.style["word-wrap"]="break-word",o.style["white-space"]="normal",o.style["font-family"]=""==t.style["font-family"]?"monospace":t.style["font-family"],o.style["font-size"]=t.style["font-size"],o.style["line-height"]=""==t.style["line-height"]?"normal":t.style["line-height"],o.style["min-height"]="12px";var l=document.getElementsByTagName("body")[0];l.parentNode.insertBefore(o,l.nextSibling),t.style.height=$(o).height()+6+"px",t.style.width=$(o).width()+10+"px"};this.newTextArea=function(e){p(),o=e;var t=document.createElement("textarea");t=u(t,c);var n,l=[(n=e).pageX,n.pageY];t.style.left=l[0]+"px",t.style.top=l[1]+"px",s.parentNode.insertBefore(t,s.nextSibling),t.onpaste=function(e){f(e,t)},t.onkeydown=function(e){f(e,t)},t.onfocus=function(){t.style.border="1px dotted #cccccc"},t.onblur=function(){d(i,o,function(e){y(0)}),t.style.border="none",t.style.display="none"},t.focus(),i=t,a.push(t)};var u=function(e,t){for(var n in t)e.style[n]=t[n];return e},y=function(e){var t=a[e];t.parentNode&&t.parentNode.removeChild(t),a.splice(e,1)},p=function(){a.forEach(function(e,t){""==e.value?y(t):e.value.length>0&&d(i,o)})};document.keydown=function(e){27==e.keyCode&&y(a.length-1)}}};